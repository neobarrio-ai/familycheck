<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>FamilyCheck</title>

<style>
body {
  font-family: system-ui, sans-serif;
  background: #f7f7f7;
  margin: 0;
  padding: 16px;
}
h1 { font-size: 1.4rem; }

.card {
  background: #fff;
  padding: 16px;
  border-radius: 8px;
  margin-bottom: 16px;
}

label {
  font-weight: 600;
  display: block;
  margin-top: 12px;
}

input, select {
  width: 100%;
  padding: 8px;
  margin-top: 4px;
}

.grid {
  display: grid;
  grid-template-columns: 1fr repeat(4, 50px);
  gap: 6px;
  align-items: center;
}

.radio {
  text-align: center;
}

.presencia {
  grid-column: 1 / -1;
  font-size: 0.85rem;
  margin-left: 6px;
  display: none;
}

.result {
  background: #eef6ff;
  padding: 12px;
  border-radius: 6px;
  font-weight: 600;
}

button {
  width: 100%;
  padding: 12px;
  margin-top: 10px;
  background: #0066cc;
  color: #fff;
  border: none;
  border-radius: 6px;
}

.list-item {
  display: flex;
  justify-content: space-between;
  border-bottom: 1px solid #eee;
  padding: 8px 0;
}
</style>
</head>

<body>

<h1>âž• AÃ±adir ficha â€“ FamilyCheck</h1>

<div class="card">
  <label>Tipo</label>
  <select id="tipo">
    <option value="pelicula">PelÃ­cula</option>
    <option value="libro">Libro</option>
  </select>

  <label>TÃ­tulo</label>
  <input id="titulo">

  <label>AÃ±o / ISBN</label>
  <input id="extra1">

  <label>Director / Autor</label>
  <input id="extra2">
</div>

<div class="card">
  <h2>EvaluaciÃ³n de contenido</h2>

  <div class="grid">
    <strong></strong>
    <strong>Nada</strong><strong>Leve</strong><strong>Mod.</strong><strong>Sev.</strong>

    <script>
    const categorias = ["sexo","violencia","lenguaje","drogas","miedo"];
    document.write(categorias.map(c => `
      <strong>${c.charAt(0).toUpperCase()+c.slice(1)}</strong>
      ${[0,1,2,3].map(v=>`
        <div class="radio">
          <input type="radio" name="${c}" value="${v}"
            ${v===0?"checked":""}
            onchange="mostrarPresencia('${c}')">
        </div>`).join("")}

      <div class="presencia" id="pres_${c}">
        Presencia:
        <label><input type="radio" name="pres_${c}" value="puntual" checked onchange="actualizar()"> Puntual</label>
        <label><input type="radio" name="pres_${c}" value="continuado" onchange="actualizar()"> Continuado</label>
      </div>
    `).join(""));
    </script>
  </div>
</div>

<div class="result" id="resultado">
Edad recomendada: â€” <br> FC: â€”
</div>

<button onclick="guardar()">Guardar ficha</button>
<button onclick="toggleListado()">ðŸ“‹ Ver fichas</button>

<div class="card" id="listado" style="display:none;">
  <input id="buscador" placeholder="Buscar..." oninput="renderListado()">
  <div id="resultadoListado"></div>
</div>

<script>
let estado = {};

function mostrarPresencia(cat) {
  const nivel = Number(document.querySelector(`input[name=${cat}]:checked`).value);
  const bloque = document.getElementById(`pres_${cat}`);
  bloque.style.display = nivel >= 2 ? "block" : "none";
  actualizar();
}

function actualizar() {
  categorias.forEach(c => {
    const nivel = Number(document.querySelector(`input[name=${c}]:checked`).value);
    if (nivel >= 2) {
      const pres = document.querySelector(`input[name=pres_${c}]:checked`).value;
      estado[c] = {nivel, pres};
    } else estado[c] = {nivel};
  });
  calcularFC();
}

function calcularFC() {
  let fc = 9;
  Object.values(estado).forEach(d=>{
    if(d.nivel===2) fc -= d.pres==="continuado"?1:0.5;
    if(d.nivel===3) fc -= d.pres==="continuado"?2:1;
  });
  fc = Math.max(1,Math.min(10,Math.round(fc)));
  let edad = fc>=8?7:fc>=6?12:16;
  resultado.innerHTML = `Edad recomendada: ${edad}+<br>FC: ${fc}/10`;
}

function guardar() {
  const ficha = {
    id: crypto.randomUUID(),
    tipo: tipo.value,
    titulo: titulo.value,
    extra1: extra1.value,
    extra2: extra2.value,
    estado
  };
  const data = JSON.parse(localStorage.getItem("fc")||"[]");
  if(data.some(f=>f.titulo.toLowerCase()===ficha.titulo.toLowerCase())) {
    alert("Ya existe");
    return;
  }
  data.push(ficha);
  localStorage.setItem("fc",JSON.stringify(data));
  alert("Guardada");
}

function toggleListado(){
  listado.style.display = listado.style.display==="none"?"block":"none";
  renderListado();
}

function renderListado(){
  const data = JSON.parse(localStorage.getItem("fc")||"[]");
  resultadoListado.innerHTML = data.map(f=>`
    <div class="list-item">
      <div><strong>${f.titulo}</strong><br>${f.extra1} Â· ${f.extra2}</div>
      <button onclick="borrar('${f.id}')">ðŸ—‘</button>
    </div>`).join("");
}

function borrar(id){
  let data = JSON.parse(localStorage.getItem("fc")||"[]");
  data = data.filter(f=>f.id!==id);
  localStorage.setItem("fc",JSON.stringify(data));
  renderListado();
}

actualizar();
</script>

</body>
</html>
