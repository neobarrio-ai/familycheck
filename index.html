<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>FamilyCheck</title>

<style>
:root {
  --verde: #2e7d32;
  --azul: #1565c0;
  --naranja: #ef6c00;
  --rojo: #c62828;
  --fondo: #f5f7fa;
  --card: #ffffff;
  --borde: #e0e0e0;
}

body {
  font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
  background: var(--fondo);
  margin: 0;
  padding: 16px;
  color: #222;
}

h1 {
  font-size: 1.4rem;
  margin-bottom: 16px;
}

.card {
  background: var(--card);
  border-radius: 12px;
  padding: 16px;
  margin-bottom: 16px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.05);
}

label {
  font-weight: 600;
  display: block;
  margin-top: 12px;
}

input, select {
  width: 100%;
  padding: 10px;
  margin-top: 6px;
  font-size: 1rem;
  border-radius: 8px;
  border: 1px solid var(--borde);
}

.categoria {
  padding: 12px 0;
  border-bottom: 1px solid var(--borde);
}

.categoria:last-child {
  border-bottom: none;
}

.cabecera {
  font-weight: 600;
  margin-bottom: 6px;
}

.opciones {
  display: flex;
  justify-content: space-between;
  margin-top: 6px;
}

.opciones label {
  font-weight: normal;
  font-size: 0.9rem;
}

.presencia {
  margin-top: 6px;
  font-size: 0.85rem;
  display: none;
}

.resultado {
  padding: 16px;
  border-radius: 12px;
  font-weight: 600;
}

.A { background:#e8f5e9; color:var(--verde); }
.B { background:#e3f2fd; color:var(--azul); }
.C { background:#fff3e0; color:var(--naranja); }
.D { background:#ffebee; color:var(--rojo); }

button {
  width: 100%;
  padding: 14px;
  margin-top: 16px;
  border-radius: 10px;
  border: none;
  font-size: 1rem;
  background: var(--azul);
  color: #fff;
}
</style>
</head>

<body>

<h1>➕ Añadir ficha – FamilyCheck</h1>

<div class="card">
  <label>Título</label>
  <input id="titulo">
</div>

<div class="card" id="evaluacion"></div>

<div class="resultado A" id="resultado">
  Edad recomendada: —<br>
  FamilyCheck: —
</div>

<script>
const categorias = [
  { id:"sexo", nombre:"Sexo y desnudos" },
  { id:"violencia", nombre:"Violencia" },
  { id:"lenguaje", nombre:"Lenguaje" },
  { id:"drogas", nombre:"Alcohol y drogas" },
  { id:"miedo", nombre:"Miedo / impacto emocional" }
];

let estado = {};

const contenedor = document.getElementById("evaluacion");

categorias.forEach(cat => {
  contenedor.innerHTML += `
    <div class="categoria">
      <div class="cabecera">${cat.nombre}</div>
      <div class="opciones">
        ${["Nada","Leve","Mod.","Sev."].map((txt,i) => `
          <label>
            <input type="radio" name="${cat.id}" value="${i}"
              ${i===0?"checked":""}
              onchange="actualizar('${cat.id}')">
            ${txt}
          </label>
        `).join("")}
      </div>

      <div class="presencia" id="pres_${cat.id}">
        Presencia:
        <label>
          <input type="radio" name="pres_${cat.id}" value="puntual" checked
            onchange="actualizar('${cat.id}')">
          Puntual
        </label>
        <label>
          <input type="radio" name="pres_${cat.id}" value="continuado"
            onchange="actualizar('${cat.id}')">
          Continuado
        </label>
      </div>
    </div>
  `;
});

function actualizar(cat) {
  const nivel = Number(document.querySelector(`input[name=${cat}]:checked`).value);
  const pres = document.getElementById(`pres_${cat}`);

  if (nivel >= 2) {
    pres.style.display = "block";
    const p = document.querySelector(`input[name=pres_${cat}]:checked`).value;
    estado[cat] = { nivel, presencia: p };
  } else {
    pres.style.display = "none";
    estado[cat] = { nivel };
  }

  calcularFC();
}

function calcularFC() {
  let fc = 9;

  Object.values(estado).forEach(d => {
    if (d.nivel === 2) fc -= d.presencia==="continuado" ? 1 : 0.5;
    if (d.nivel === 3) fc -= d.presencia==="continuado" ? 2 : 1;
  });

  fc = Math.round(Math.max(1, Math.min(10, fc)));

  let letra = "A", clase="A", edad=7;
  if (fc <= 3) { letra="D"; clase="D"; edad=16; }
  else if (fc <= 6) { letra="C"; clase="C"; edad=12; }
  else if (fc <= 8) { letra="B"; clase="B"; edad=12; }

  const r = document.getElementById("resultado");
  r.className = `resultado ${clase}`;
  r.innerHTML = `
    Edad recomendada: ${edad}+<br>
    FamilyCheck: <strong>${letra}</strong> · FC ${fc}/10
  `;
}

// Inicializar
categorias.forEach(c => estado[c.id]={nivel:0});
calcularFC();
</script>

</body>
</html>
